<%-include('../layouts/header')%>
<%-include('../layouts/navbar')%>

<div class="page-wrapper">
    <main class="main">
        <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
            <div class="container">
                <h1 class="page-title">Wishlist<span>Shop</span></h1>
            </div><!-- End .container -->
        </div><!-- End .page-header -->
        <nav aria-label="breadcrumb" class="breadcrumb-nav">
            <div class="container">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="/product">Shop</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Wishlist</li>
                </ol>
            </div><!-- End .container -->
        </nav><!-- End .breadcrumb-nav -->

        <div class="page-content">
            <div class="container">
                <table class="table table-wishlist table-mobile">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Stock Status</th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody>
                        <% if(Array.isArray(wishlistData) && wishlistData.length > 0) { %>
                            <% wishlistData.forEach(item => { %>
                                <tr>
                                    <td class="product-col">
                                        <div class="product">
                                            <figure class="product-media">
                                                <a>
                                                    <img src="/IMAGES/<%= item.productId.Inputimage[0].filename %>" alt="product image">
                                                </a>
                                            </figure>
                    
                                            <h3 class="product-title">
                                                <a><%= item.productId.name %></a>
                                            </h3>
                                        </div>
                                    </td>
                                    <td class="price-col">â‚¹ <%= item.productId.price %></td>
                                    <% if(item.productId.quantity > 0) { %>
                                        <td class="stock-col"><span class="in-stock">In stock</span></td>
                                    <% } else { %>
                                        <td class="stock-col"><span class="out-of-stock">Out of stock</span></td>
                                    <% } %>
                                    <td class="action-col">
                                        <% if(item.productId.quantity > 0) { %>
                                            <button onclick="addtocart('<%= item.productId._id %>')" class="btn btn-block btn-outline-primary-2"><i class="icon-cart-plus"></i>Add to Cart</button>
                                        <% } else { %>
                                            <button class="btn btn-block btn-outline-primary-2 disabled">Out of Stock</button>
                                        <% } %>
                                    </td>
                                    <td class="remove-col"><button class="btn-remove" onclick="removeCart('<%= item.productId._id %>')"><i class="icon-close"></i></button></td>
                                </tr>
                            <% }) %>
                        <% } else { %>
                            <tr>
                                <td colspan="5">Your wishlist is empty.</td>
                            </tr>
                        <% } %>
                    </tbody>

                </table><!-- End .table table-wishlist -->
                <div class="wishlist-share">
                    <div class="social-icons social-icons-sm mb-2">
                        <label class="social-label">Share on:</label>
                        <a href="#" class="social-icon" title="Facebook" target="_blank"><i class="icon-facebook-f"></i></a>
                        <a href="#" class="social-icon" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>
                        <a href="#" class="social-icon" title="Instagram" target="_blank"><i class="icon-instagram"></i></a>
                        <a href="#" class="social-icon" title="Youtube" target="_blank"><i class="icon-youtube"></i></a>
                        <a href="#" class="social-icon" title="Pinterest" target="_blank"><i class="icon-pinterest"></i></a>
                    </div><!-- End .soial-icons -->
                </div><!-- End .wishlist-share -->
            </div><!-- End .container -->
        </div><!-- End .page-content -->
    </main><!-- End .main -->
</div>

<script>
    function addtocart(productId){
        const quantity=1;
        fetch(`/addToCart?productId=${productId}&quantity=${quantity}`,{
            method:'POST'})
            .then(response=>response.json())
            .then(data=>{
                if(data.success){
                    Swal.fire({
                        icon:'success',
                        title:'Success',
                        text:'successfully product added to cart',
                        showConfiremButton:true,
                        timer:2500,
                    })
                    .then(()=>{
                        window.location.reload()
                    });
                }else{
                    Swal.fire({
                        icon:'error',
                        title:'Error',
                        text:'failed to add product to cart',
                        showConfiremButton:false,
                        timer:2500
                    })
                }
            })
            .catch(error=>{
               
                Swal.fire(
                    'Error',
                    'An unexpected error occurred',
                    'error'
                );
             console.log(error);
            })
    }
</script>

<script>
    function removeCart(productId){
        Swal.fire({
            title:'Are you sure ?',
            icon:'question',
            text:'you want remove product from the cart',
            showCancelButton:true,
            confirmButtonText:`Yes`,
            timer:2500,
        }).then((result)=>{
            if(result.isConfirmed){
                fetch(`/removeWishlist?productId=${productId}`,{method:'POST'})
                .then(response=>response.json())
                .then(data=>{
                    if(data.success){
                        Swal.fire({
                            title:'successfull',
                            icon:'success',
                            text:'you product removed from cart'
                        }).then((result)=>{
                            window.location.reload()
                        })
                    }else{
                        Swal.fire({
                            title:'Error',
                            icon:'error',
                            text:'you product removed from cart'
                        })
                    }
                }).catch(error=>{
                    console.log('Fetch error:',error);
                    window.location.reload()
                })
            }
        })
    }
</script>
<%-include('../layouts/footbar') %>
<%-include('../layouts/footer') %>