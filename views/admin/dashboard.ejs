<%-include('../layouts/adminHeader')%>
<%-include('../layouts/adminSidebar')%>
<style>
    #myChart {
        width: 100% !important;
        height: 350px !important;
    }

    .slideshow-container {
        position: relative;
        max-width: 100%;
        margin: auto;
        overflow: hidden;
    }

    .mySlides {
        display: none;
        display: flex;
        justify-content: center;
        gap: 10px;
    }

    .mySlides img {
        display: block;
    }

    .prev, .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 16px;
        margin-top: -22px;
        color: white;
        font-weight: bold;
        font-size: 18px;
        transition: 0.6s ease;
        border-radius: 0 3px 3px 0;
        user-select: none;
    }

    .next {
        right: 0;
        border-radius: 3px 0 0 3px;
    }

    .prev {
        left: 0;
        border-radius: 3px 0 0 3px;
    }

    .prev:hover, .next:hover {
        background-color: rgba(0, 0, 0, 0.8);
    }
    .category-box {
        padding: 10px;
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        background-color: #ded7e4;
        transition: transform 0.2s ease;
        text-align: center;
    }

    .category-box:hover {
        transform: translateY(-10px);
    }

    .category-content {
        padding: 15px;
    }

    .category-box p {
        margin: 10px 0;
    }

</style>

<div class="pc-container" style="background-color: rgb(234, 230, 230);">
    <div class="pcoded-content">
        <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="page-header-title">
                            <h5 class="m-b-10">Dashboard sale</h5>
                        </div>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                            <li class="breadcrumb-item">Dashboard sale</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <!-- [ Main Content ] start -->
        <div class="row" >
            <!-- support-section start -->
            <div class="col-xl-6 col-md-12">
                <div class="card flat-card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Best Selling Product</h5>
                        <div class="slideshow-container">
                            <% topSellingProducts.forEach((item, index) => { %>
                            <div class="mySlides">
                                <div style="background-color: rgb(234, 230, 230); padding: 10px; text-align: center;">
                                    <img src="/IMAGES/<%= item.Inputimage[0].filename%>" alt="Best Selling Product" style="width: 100%; max-width: 200px; max-height: 200px; height: auto;">
                                    <h6 class="card-subtitle mt-3">Total Sold No : <%= item.soldProductCount %></h6>
                                </div>
                            </div>
                            <% }) %>
                            <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                            <a class="next" onclick="plusSlides(1)">&#10095;</a>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-xl-12 col-md-12">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="card prod-p-card background-pattern">
                                    <div class="card-body">
                                        <div class="row align-items-center m-b-0">
                                            <div class="col">
                                                <h6 class="m-b-5">Total Revenue</h6>
                                                <h3 class="m-b-0">â‚¹<%= totalRevenue%></h3>
                                            </div>
                                            <div class="col-auto">
                                                <i class="material-icons-two-tone text-primary">monetization_on</i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="card prod-p-card bg-primary background-pattern-white">
                                    <div class="card-body">
                                        <div class="row align-items-center m-b-0">
                                            <div class="col">
                                                <h6 class="m-b-5 text-white">Number of Orders</h6>
                                                <h3 class="m-b-0 text-white"><%= orderCount %></h3>
                                            </div>
                                            <div class="col-auto">
                                                <i class="material-icons-two-tone text-white">local_mall</i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="card prod-p-card bg-primary background-pattern-white">
                                    <div class="card-body">
                                        <div class="row align-items-center m-b-0">
                                            <div class="col">
                                                <h6 class="m-b-5 text-white">Product Sold</h6>
                                                <h3 class="m-b-0 text-white"><%= productCount %></h3>
                                            </div>
                                            <div class="col-auto">
                                                <i class="material-icons-two-tone text-white">local_offer</i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="card prod-p-card background-pattern">
                                    <div class="card-body">
                                        <div class="row align-items-center m-b-0">
                                            <div class="col" style="height: 60px;">
                                                <a href="/admin/sales" style="text-decoration: none;"><h6 class="mt-3">Sales Report</h6></a>
                                            </div>
                                            <div class="col-auto">
                                                <i class="material-icons-two-tone text-primary">card_giftcard</i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-6 col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5>Department wise sales report</h5>
                        <select id="timePeriod" class="form-select" style="max-width: 150px;">
                            <option disabled selected>select</option>
                            <option value="daily">Daily</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Yearly</option>
                        </select>
                    </div>
                    <div class="card-body mt-5" style="height: 450px;">
                        <canvas id="myChart" style="width:100%; height: 100%;"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div style="background-color: #fff;">
            <div class="text-center" style="height: 100px;">
                <h3 class="font-weight-bold pt-4">TOP SELLING CATEGORIES</h3><br><br><br>
            </div>
            <div class="row justify-content-center">
                <% topSellingCategory.forEach((item, index) => { %>
                    <div class="col-lg-2 category-box">
                        <div class="category-content ml-4">
                            <p class="font-weight-bold" style="font-size: large;">TOP <%= index + 1 %></p>
                            <p class="font-weight-bold">SOLD: <%= item.soldCount ? item.soldCount : 0 %></p>
                            <p class="font-weight-bold"><%= item.name %></p>
                        </div>
                    </div>
                <% }) %>
            </div><br><br>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script>
   let myChart;

   function createChart(data) {
       const ctx = document.getElementById('myChart').getContext('2d');
       if (myChart) {
           myChart.destroy();
       }
       myChart = new Chart(ctx, {
           type: 'bar',
           data: {
               labels: data.labels,
               datasets: [{
                   label: data.datasets[0].label,
                   backgroundColor: data.datasets[0].backgroundColor,
                   data: data.datasets[0].data
               }]
           },
           options: {
               scales: {
                   yAxes: [{
                       ticks: {
                           beginAtZero: true,
                           callback: function(value) {
                               if (Number.isInteger(value)) {
                                   return value;
                               }
                           }
                       }
                   }]
               },
               title: {
                   display: true,
                   text: data.datasets[0].label
               },
               legend: {
                   display: false
               }
           }
       });
   }

   document.getElementById('timePeriod').addEventListener('change', function () {
       var selectedItem = this.value;
       fetch('/admin/chart', {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json'
           },
           body: JSON.stringify({
               selectedItem
           })
       }).then(response => response.json())
       .then(data => {
           createChart(data);
       });
   });

   document.addEventListener('DOMContentLoaded', function () {
       fetch('/admin/chart', {
           method: 'POST',
           headers: {
               'Content-Type': 'application/json'
           },
           body: JSON.stringify({
               selectedItem: 'daily'
           })
       }).then(response => response.json())
       .then(data => {
           createChart(data);
           document.getElementById('timePeriod').value = 'daily';
       });
   });
</script>

<script>
    let slideIndex = 1;
    showSlides(slideIndex);
    
    function plusSlides(n) {
        showSlides(slideIndex += n);
    }
    
    function showSlides(n) {
        let i;
        let slides = document.getElementsByClassName("mySlides");
        if (n > slides.length) {
            slideIndex = 1;
        } 
        if (n < 1) {
            slideIndex = slides.length;
        }
        for (i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";
        }
        slides[slideIndex - 1].style.display = "flex";
    }
    </script>

<%-include('../layouts/adminFooter')%>